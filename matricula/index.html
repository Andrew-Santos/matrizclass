<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matrícula | Matriz Class Jurídico</title>

    <link rel="shortcut icon" href="https://matrizclass.teamcriativa.com/matricula/icone.svg" type="image/x-icon">
    
    <meta property="og:title" content="Matrícula - Curso Preparatório OAB">
    <meta property="og:description" content="Preencha seus dados para realizar a matrícula.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://matrizclass.teamcriativa.com/matricula/og.jpg">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            color: #1C1C1E;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 480px;
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(46, 156, 149, 0.3), 0 0 0 1px rgba(46, 156, 149, 0.1);
        }

        .header {
            padding: 32px 24px 24px;
            text-align: center;
            background: linear-gradient(135deg, #2E9C95 0%, #248a84 100%);
            border-bottom: 3px solid #D26A29;
        }

        .logo {
            width: 120px;
            height: auto;
            margin: 0 auto 20px;
            display: block;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
            color: #ffffff;
            letter-spacing: 0.3px;
        }

        .header p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
        }

        .progress-bar {
            height: 4px;
            background: rgba(46, 156, 149, 0.15);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #D26A29 0%, #2E9C95 100%);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(210, 106, 41, 0.4);
        }

        .form-content {
            padding: 32px 24px;
            min-height: 280px;
        }

        .question {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .question.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-number {
            font-size: 11px;
            font-weight: 700;
            color: #2E9C95;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 18px;
            color: #1C1C1E;
            line-height: 1.4;
        }

        .required {
            color: #D26A29;
        }

        input[type="text"],
        input[type="tel"],
        input[type="email"],
        select {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid #A1D6D3;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #F4F4F4;
            color: #1C1C1E;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%232E9C95' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #2E9C95;
            background: #fff;
            box-shadow: 0 0 0 3px rgba(46, 156, 149, 0.15);
        }

        input::placeholder {
            color: #B0B0B0;
        }

        input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            border: 2px solid #A1D6D3;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #F4F4F4;
        }

        .radio-option:hover {
            border-color: #2E9C95;
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 156, 149, 0.15);
        }

        .radio-option.selected {
            border-color: #2E9C95;
            background: linear-gradient(135deg, #A1D6D3 0%, rgba(161, 214, 211, 0.3) 100%);
            box-shadow: 0 0 0 3px rgba(46, 156, 149, 0.1);
        }

        .radio-option input {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2E9C95;
        }

        .radio-option label {
            cursor: pointer;
            font-size: 15px;
            color: #1C1C1E;
            flex: 1;
            font-weight: 500;
        }

        .toggle-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .toggle-btn {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #A1D6D3;
            border-radius: 8px;
            background: #F4F4F4;
            font-size: 13px;
            font-weight: 600;
            color: #1C1C1E;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            border-color: #2E9C95;
            transform: translateY(-1px);
        }

        .toggle-btn.active {
            border-color: #2E9C95;
            background: linear-gradient(135deg, #2E9C95 0%, #248a84 100%);
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(46, 156, 149, 0.3);
        }

        .loading-indicator {
            display: none;
            font-size: 12px;
            color: #2E9C95;
            margin-top: 8px;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .loading-indicator.active {
            display: flex;
        }

        .loading-indicator i {
            font-size: 14px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            font-size: 11px;
            color: #FF3B30;
            margin-top: 4px;
        }

        .error-message.active {
            display: block;
        }

        .actions {
            padding: 20px 24px;
            border-top: 2px solid #A1D6D3;
            display: flex;
            gap: 12px;
            background: #F4F4F4;
        }

        button {
            flex: 1;
            padding: 13px 18px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
        }

        button i {
            font-size: 18px;
        }

        #btnBack {
            background: #A1D6D3;
            color: #1C1C1E;
        }

        #btnBack:hover:not(:disabled) {
            background: #8bc4c0;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(161, 214, 211, 0.4);
        }

        #btnNext {
            background: linear-gradient(135deg, #2E9C95 0%, #248a84 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(46, 156, 149, 0.3);
        }

        #btnNext:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 156, 149, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 48px 24px;
        }

        .success-message.active {
            display: block;
        }

        .success-message i {
            font-size: 72px;
            color: #2E9C95;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(46, 156, 149, 0.3));
        }

        .success-message h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #1C1C1E;
        }

        .success-message p {
            font-size: 15px;
            color: #B0B0B0;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(28, 28, 30, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            border-radius: 16px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(46, 156, 149, 0.3);
        }

        .modal-header {
            padding: 24px 24px 20px;
            border-bottom: 2px solid #A1D6D3;
            background: linear-gradient(135deg, #F4F4F4 0%, rgba(161, 214, 211, 0.2) 100%);
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }

        .modal-body {
            padding: 24px;
        }

        .review-item {
            margin-bottom: 18px;
            padding-bottom: 18px;
            border-bottom: 2px solid #A1D6D3;
        }

        .review-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .review-item-label {
            font-size: 11px;
            font-weight: 700;
            color: #2E9C95;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 6px;
        }

        .review-item-value {
            font-size: 15px;
            color: #1C1C1E;
            font-weight: 500;
        }

        .modal-actions {
            padding: 20px 24px;
            border-top: 2px solid #A1D6D3;
            display: flex;
            gap: 12px;
            background: #F4F4F4;
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
                background: #fff;
            }

            .container {
                border-radius: 0;
                min-height: 100vh;
                box-shadow: none;
            }

            .header {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://matrizclass.teamcriativa.com/matricula/logo.svg" alt="Matriz Class Jurídico" class="logo">
            <h1>Matrícula - Curso Preparatório OAB</h1>
            <p>Preencha as informações solicitadas</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="form-content" id="formContent">
            <!-- Perguntas serão inseridas aqui via JavaScript -->
            
            <div class="success-message" id="successMessage">
                <i class="ph ph-check-circle"></i>
                <h2>Matrícula enviada com sucesso!</h2>
                <p>Em breve entraremos em contato para finalizar o processo.</p>
            </div>
        </div>

        <div class="actions">
            <button id="btnBack" disabled>
                <i class="ph ph-caret-left"></i>
                Voltar
            </button>
            <button id="btnNext" disabled>
                Avançar
                <i class="ph ph-caret-right"></i>
            </button>
        </div>
    </div>

    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Revisar Informações</h2>
            </div>
            <div class="modal-body" id="reviewBody"></div>
            <div class="modal-actions">
                <button onclick="closeReviewModal()" style="background: #A1D6D3; color: #1C1C1E; font-weight: 700;">
                    Editar
                </button>
                <button onclick="confirmSubmit()" style="background: linear-gradient(135deg, #2E9C95 0%, #248a84 100%); color: #fff; box-shadow: 0 4px 12px rgba(46, 156, 149, 0.3);">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://roqyvjfinklkjrwyrqow.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvcXl2amZpbmtsa2pyd3lycW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3Nzg0MjUsImV4cCI6MjA4NTM1NDQyNX0.nv9RWORgStI0encVGqeIoX2CNt0zYQqXKVwMpbzLOFg';

        const questions = [
            {
                id: 'nome_completo',
                number: '1 de 12',
                title: 'Qual o seu nome completo?',
                type: 'text',
                placeholder: 'Digite seu nome completo',
                required: true
            },
            {
                id: 'cpf',
                number: '2 de 12',
                title: 'Qual o seu CPF?',
                type: 'tel',
                placeholder: '000.000.000-00',
                required: true,
                maxLength: 14
            },
            {
                id: 'rg',
                number: '3 de 12',
                title: 'Qual o seu RG?',
                type: 'tel',
                placeholder: '00.000.000-0',
                required: true,
                maxLength: 12,
                hasToggle: true
            },
            {
                id: 'telefone',
                number: '4 de 12',
                title: 'Qual o seu telefone?',
                type: 'tel',
                placeholder: '(00) 00000-0000',
                required: true,
                maxLength: 15
            },
            {
                id: 'email',
                number: '5 de 12',
                title: 'Qual o seu e-mail?',
                type: 'email',
                placeholder: 'seu@email.com',
                required: true
            },
            {
                id: 'cep',
                number: '6 de 12',
                title: 'Qual o seu CEP?',
                type: 'tel',
                placeholder: '00000-000',
                required: true,
                maxLength: 9
            },
            {
                id: 'logradouro',
                number: '7 de 12',
                title: 'Qual o seu endereço?',
                type: 'text',
                placeholder: 'Rua, Avenida, etc.',
                required: true
            },
            {
                id: 'numero',
                number: '8 de 12',
                title: 'Qual o número?',
                type: 'text',
                placeholder: 'Número',
                required: true,
                maxLength: 10
            },
            {
                id: 'cidade',
                number: '9 de 12',
                title: 'Qual a sua cidade?',
                type: 'text',
                placeholder: 'Digite sua cidade',
                required: true
            },
            {
                id: 'estado',
                number: '10 de 12',
                title: 'Qual o seu estado?',
                type: 'text',
                placeholder: 'UF (ex: SP)',
                required: true,
                maxLength: 2
            },
            {
                id: 'concluiu_ensino_superior',
                number: '11 de 12',
                title: 'Já concluiu o ensino superior?',
                type: 'radio',
                options: ['Sim', 'Não', 'Estou cursando'],
                required: true
            },
            {
                id: 'instituicao',
                number: '12 de 12',
                title: 'Qual instituição de ensino?',
                type: 'text',
                placeholder: 'Nome da instituição',
                required: true,
                maxLength: 200
            }
        ];

        let currentQuestion = 0;
        let formData = {};
        let rgUsesCpfFormat = false;

        function applyCpfMask(value) {
            value = value.replace(/\D/g, '');
            value = value.substring(0, 11);
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            return value;
        }

        function applyRgMask(value) {
            value = value.replace(/\D/g, '');
            value = value.substring(0, 9);
            value = value.replace(/(\d{2})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1})$/, '$1-$2');
            return value;
        }

        function applyPhoneMask(value) {
            value = value.replace(/\D/g, '');
            value = value.substring(0, 11);
            value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
            value = value.replace(/(\d)(\d{4})$/, '$1-$2');
            return value;
        }

        function applyCepMask(value) {
            value = value.replace(/\D/g, '');
            value = value.substring(0, 8);
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            return value;
        }

        function removeMask(value) {
            return value.replace(/\D/g, '');
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        async function buscarCep(cep) {
            const cepLimpo = removeMask(cep);
            
            if (cepLimpo.length !== 8) {
                return null;
            }

            const loadingIndicator = document.getElementById('loading-cep');
            const errorMessage = document.getElementById('error-cep');
            
            if (loadingIndicator) loadingIndicator.classList.add('active');
            if (errorMessage) errorMessage.classList.remove('active');

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
                const data = await response.json();

                if (loadingIndicator) loadingIndicator.classList.remove('active');

                if (data.erro) {
                    if (errorMessage) {
                        errorMessage.textContent = 'CEP não encontrado.';
                        errorMessage.classList.add('active');
                    }
                    return null;
                }

                return data;
            } catch (error) {
                if (loadingIndicator) loadingIndicator.classList.remove('active');
                if (errorMessage) {
                    errorMessage.textContent = 'Erro ao buscar CEP.';
                    errorMessage.classList.add('active');
                }
                return null;
            }
        }

        function toggleRgFormat(format) {
            rgUsesCpfFormat = (format === 'cpf');
            
            // Atualiza botões
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Atualiza o campo
            const rgInput = document.getElementById('rg');
            if (rgInput) {
                const currentValue = removeMask(rgInput.value);
                
                if (rgUsesCpfFormat) {
                    rgInput.placeholder = '000.000.000-00';
                    rgInput.maxLength = 14;
                    if (currentValue) {
                        rgInput.value = applyCpfMask(currentValue);
                    }
                } else {
                    rgInput.placeholder = '00.000.000-0';
                    rgInput.maxLength = 12;
                    if (currentValue) {
                        rgInput.value = applyRgMask(currentValue);
                    }
                }
                
                rgInput.focus();
            }
        }

        function handleInput(fieldId) {
            const input = document.getElementById(fieldId);
            let value = input.value;

            if (fieldId === 'cpf') {
                value = applyCpfMask(value);
                input.value = value;
                formData[fieldId] = removeMask(value);
            } else if (fieldId === 'rg') {
                if (rgUsesCpfFormat) {
                    value = applyCpfMask(value);
                } else {
                    value = applyRgMask(value);
                }
                input.value = value;
                formData[fieldId] = removeMask(value);
            } else if (fieldId === 'telefone') {
                value = applyPhoneMask(value);
                input.value = value;
                formData[fieldId] = removeMask(value);
            } else if (fieldId === 'cep') {
                value = applyCepMask(value);
                input.value = value;
                const cepLimpo = removeMask(value);
                formData[fieldId] = cepLimpo;
                
                if (cepLimpo.length === 8) {
                    buscarCep(value).then(data => {
                        if (data) {
                            if (data.logradouro) {
                                formData['logradouro'] = data.logradouro;
                                const logradouroInput = document.getElementById('logradouro');
                                if (logradouroInput) logradouroInput.value = data.logradouro;
                            }
                            
                            if (data.localidade) {
                                formData['cidade'] = data.localidade;
                                const cidadeInput = document.getElementById('cidade');
                                if (cidadeInput) cidadeInput.value = data.localidade;
                            }
                            
                            if (data.uf) {
                                formData['estado'] = data.uf;
                                const estadoInput = document.getElementById('estado');
                                if (estadoInput) estadoInput.value = data.uf;
                            }
                            
                            saveData();
                        }
                    });
                }
            } else if (fieldId === 'estado') {
                value = value.toUpperCase().substring(0, 2);
                input.value = value;
                formData[fieldId] = value;
            } else if (fieldId === 'email') {
                formData[fieldId] = value.toLowerCase().trim();
            } else {
                formData[fieldId] = value;
            }

            saveData();
            updateButtons();
        }

        function selectRadio(fieldId, value) {
            formData[fieldId] = value;
            saveData();
            
            document.querySelectorAll(`[name="${fieldId}"]`).forEach((radio) => {
                const parent = radio.closest('.radio-option');
                if (radio.value === value) {
                    parent.classList.add('selected');
                    radio.checked = true;
                } else {
                    parent.classList.remove('selected');
                    radio.checked = false;
                }
            });
            
            updateButtons();
        }

        function loadSavedData() {
            const saved = localStorage.getItem('matriculaOabData');
            if (saved) {
                formData = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('matriculaOabData', JSON.stringify(formData));
        }

        function renderQuestions() {
            const container = document.getElementById('formContent');
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = `question ${index === 0 ? 'active' : ''}`;
                questionDiv.id = `question-${index}`;

                let inputHtml = '';

                if (q.type === 'text' || q.type === 'tel' || q.type === 'email') {
                    let displayValue = formData[q.id] || '';
                    
                    if (q.id === 'cpf' && displayValue) {
                        displayValue = applyCpfMask(displayValue);
                    } else if (q.id === 'rg' && displayValue) {
                        displayValue = rgUsesCpfFormat ? applyCpfMask(displayValue) : applyRgMask(displayValue);
                    } else if (q.id === 'telefone' && displayValue) {
                        displayValue = applyPhoneMask(displayValue);
                    } else if (q.id === 'cep' && displayValue) {
                        displayValue = applyCepMask(displayValue);
                    }

                    let additionalContent = '';
                    
                    if (q.hasToggle && q.id === 'rg') {
                        additionalContent = `
                            <div class="toggle-buttons">
                                <button type="button" class="toggle-btn ${!rgUsesCpfFormat ? 'active' : ''}" onclick="toggleRgFormat('rg')">
                                    RG Antigo
                                </button>
                                <button type="button" class="toggle-btn ${rgUsesCpfFormat ? 'active' : ''}" onclick="toggleRgFormat('cpf')">
                                    RG Novo (CPF)
                                </button>
                            </div>
                        `;
                    }
                    
                    if (q.id === 'cep') {
                        additionalContent += `
                            <div class="loading-indicator" id="loading-cep">
                                <i class="ph ph-circle-notch"></i>
                                <span>Buscando...</span>
                            </div>
                            <div class="error-message" id="error-cep"></div>
                        `;
                    }

                    inputHtml = `
                        ${additionalContent}
                        <input 
                            type="${q.type}" 
                            id="${q.id}" 
                            placeholder="${q.id === 'rg' ? (rgUsesCpfFormat ? '000.000.000-00' : '00.000.000-0') : q.placeholder}"
                            value="${displayValue}"
                            maxlength="${q.id === 'rg' ? (rgUsesCpfFormat ? 14 : 12) : (q.maxLength || '')}"
                            oninput="handleInput('${q.id}')"
                        >
                    `;
                } else if (q.type === 'radio') {
                    inputHtml = '<div class="radio-group">';
                    q.options.forEach(option => {
                        const isSelected = formData[q.id] === option;
                        inputHtml += `
                            <div class="radio-option ${isSelected ? 'selected' : ''}" onclick="selectRadio('${q.id}', '${option}')">
                                <input type="radio" name="${q.id}" value="${option}" ${isSelected ? 'checked' : ''}>
                                <label>${option}</label>
                            </div>
                        `;
                    });
                    inputHtml += '</div>';
                }

                questionDiv.innerHTML = `
                    <div class="question-number">${q.number}</div>
                    <h2 class="question-title">
                        ${q.title}${q.required ? '<span class="required">*</span>' : ''}
                    </h2>
                    ${inputHtml}
                `;

                container.insertBefore(questionDiv, document.getElementById('successMessage'));
            });
        }

        function updateButtons() {
            const currentQ = questions[currentQuestion];
            let hasValue = formData[currentQ.id] && formData[currentQ.id].trim() !== '';
            
            // Validação adicional para email
            if (currentQ.id === 'email' && hasValue) {
                hasValue = validateEmail(formData[currentQ.id]);
            }
            
            document.getElementById('btnNext').disabled = !hasValue;
            document.getElementById('btnBack').disabled = currentQuestion === 0;
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showQuestion(index) {
            document.querySelectorAll('.question').forEach(q => q.classList.remove('active'));
            const questionEl = document.getElementById(`question-${index}`);
            if (questionEl) {
                questionEl.classList.add('active');
                currentQuestion = index;
                updateButtons();
                updateProgress();
                updateNextButton();
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                showReviewModal();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function updateNextButton() {
            const btnNext = document.getElementById('btnNext');
            if (currentQuestion === questions.length - 1) {
                btnNext.innerHTML = 'Revisar <i class="ph ph-check"></i>';
            } else {
                btnNext.innerHTML = 'Avançar <i class="ph ph-caret-right"></i>';
            }
        }

        function showReviewModal() {
            const reviewBody = document.getElementById('reviewBody');
            reviewBody.innerHTML = '';

            const labels = {
                'nome_completo': 'Nome Completo',
                'cpf': 'CPF',
                'rg': 'RG',
                'telefone': 'Telefone',
                'email': 'E-mail',
                'cep': 'CEP',
                'logradouro': 'Endereço',
                'numero': 'Número',
                'cidade': 'Cidade',
                'estado': 'Estado',
                'concluiu_ensino_superior': 'Concluiu o Ensino Superior?',
                'instituicao': 'Instituição de Ensino'
            };

            questions.forEach(q => {
                let value = formData[q.id] || '';

                if (q.id === 'cpf' && value) {
                    value = applyCpfMask(value);
                } else if (q.id === 'rg' && value) {
                    value = rgUsesCpfFormat ? applyCpfMask(value) : applyRgMask(value);
                } else if (q.id === 'telefone' && value) {
                    value = applyPhoneMask(value);
                } else if (q.id === 'cep' && value) {
                    value = applyCepMask(value);
                }

                const itemDiv = document.createElement('div');
                itemDiv.className = 'review-item';
                itemDiv.innerHTML = `
                    <div class="review-item-label">${labels[q.id]}</div>
                    <div class="review-item-value">${value || 'Não informado'}</div>
                `;
                reviewBody.appendChild(itemDiv);
            });

            document.getElementById('reviewModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        async function confirmSubmit() {
            try {
                const dataToSend = {
                    nome_completo: formData.nome_completo.toUpperCase(),
                    cpf: formData.cpf,
                    rg: formData.rg,
                    telefone: formData.telefone,
                    email: formData.email.toLowerCase(),
                    cep: formData.cep,
                    logradouro: formData.logradouro,
                    numero: formData.numero,
                    cidade: formData.cidade,
                    estado: formData.estado,
                    concluiu_ensino_superior: formData.concluiu_ensino_superior === 'Sim',
                    instituicao: formData.instituicao ? formData.instituicao.toUpperCase() : null,
                    semestre_atual: formData.concluiu_ensino_superior === 'Estou cursando' ? 'Em andamento' : null
                };

                const response = await fetch(`${SUPABASE_URL}/rest/v1/matriculas_oab`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(dataToSend)
                });

                if (response.ok || response.status === 201) {
                    closeReviewModal();
                    document.querySelectorAll('.question').forEach(q => q.style.display = 'none');
                    document.getElementById('successMessage').classList.add('active');
                    document.querySelector('.actions').style.display = 'none';
                    localStorage.removeItem('matriculaOabData');
                } else {
                    alert('Erro ao enviar. Tente novamente.');
                }
            } catch (error) {
                alert('Erro ao enviar. Tente novamente.');
            }
        }

        document.getElementById('btnNext').addEventListener('click', nextQuestion);
        document.getElementById('btnBack').addEventListener('click', prevQuestion);

        loadSavedData();
        renderQuestions();
        updateButtons();
        updateProgress();
        updateNextButton();
    </script>
</body>
</html>
